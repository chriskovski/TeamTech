<source>
  @type forward
  @id main_forward
  bind 0.0.0.0
  port 24240
</source>
<match **>
  @type label_router
  @id main
  metrics false
  <route>
    @label @07daa7a03df72de7a10c91ac70656f77
    metrics_labels {"id":"flow:logging:es-flow"}
    <match>
      labels app.kubernetes.io/name:log-generator
      namespaces logging
      negate false
    </match>
  </route>
  <route>
    @label @6cd81f0090827e7e39bd8c8ee06134f3
    metrics_labels {"id":"clusterflow:logging:es-flow"}
    <match>
      labels app.kubernetes.io/name:log-generator
      negate false
    </match>
  </route>
</match>
<label @07daa7a03df72de7a10c91ac70656f77>
  <match kubernetes.**>
    @type tag_normaliser
    @id flow:logging:es-flow:0
    format ${namespace_name}.${pod_name}.${container_name}
  </match>
  <filter **>
    @type parser
    @id flow:logging:es-flow:1
    key_name message
    remove_key_name_field true
    reserve_data true
    <parse>
      @type nginx
    </parse>
  </filter>
  <match **>
    @type elasticsearch
    @id flow:logging:es-flow:output:logging:es-output
    exception_backup true
    fail_on_detecting_es_version_retry_exceed true
    fail_on_putting_template_retry_exceed true
    host quickstart-es-http.logging.svc.cluster.local
    password Fe5y650obe76MuBIE1x3z87e
    port 9200
    reload_connections true
    scheme https
    ssl_verify false
    ssl_version TLSv1_2
    user elastic
    utc_index true
    verify_es_version_at_startup true
    <buffer tag,time>
      @type file
      chunk_limit_size 8MB
      path /buffers/flow:logging:es-flow:output:logging:es-output.*.buffer
      retry_forever true
      timekey 1m
      timekey_use_utc true
      timekey_wait 30s
    </buffer>
  </match>
</label>
<label @6cd81f0090827e7e39bd8c8ee06134f3>
  <match kubernetes.**>
    @type tag_normaliser
    @id clusterflow:logging:es-flow:0
    format ${namespace_name}.${pod_name}.${container_name}
  </match>
  <filter **>
    @type parser
    @id clusterflow:logging:es-flow:1
    key_name message
    remove_key_name_field true
    reserve_data true
    <parse>
      @type nginx
    </parse>
  </filter>
  <match **>
    @type elasticsearch
    @id clusterflow:logging:es-flow:clusteroutput:logging:es-output
    exception_backup true
    fail_on_detecting_es_version_retry_exceed true
    fail_on_putting_template_retry_exceed true
    host quickstart-es-http.logging.svc.cluster.local
    password Fe5y650obe76MuBIE1x3z87e
    port 9200
    reload_connections true
    scheme https
    ssl_verify false
    ssl_version TLSv1_2
    user elastic
    utc_index true
    verify_es_version_at_startup true
    <buffer tag,time>
      @type file
      chunk_limit_size 8MB
      path /buffers/clusterflow:logging:es-flow:clusteroutput:logging:es-output.*.buffer
      retry_forever true
      timekey 1m
      timekey_use_utc true
      timekey_wait 30s
    </buffer>
  </match>
</label>
<label @ERROR>
  <match **>
    @type null
    @id main-fluentd-error
  </match>
</label>
